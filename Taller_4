#Taller 4

import json
import requests
from bs4 import BeautifulSoup
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy

from google.colab import drive
import os
drive.mount('/content/gdrive')

with open('/content/gdrive/MyDrive/Python/Caso NYC/data/borough_data.json') as f:
  borough_data=json.load(f)
  borough_data
  print(borough_data)
  {'the bronx': {'name': 'the bronx', 'population': 1471160.0, 'area': 42.1}, 'brooklyn': {'name': 'brooklyn', 'population': 2648771.0, 'area': 70.82}, 'manhattan': {'name': 'manhattan', 'population': 1664727.0, 'area': 22.83}, 'queens': {'name': 'queens', 'population': 2358582.0, 'area': 108.53}, 'staten island': {'name': 'staten island', 'population': 479458.0, 'area': 58.37}}
 
 with open('/content/gdrive/MyDrive/Python/Caso NYC/data/accidents.csv') as f:
  df=pd.read_csv(f, delimiter=';')
  print(df)
              DATE   TIME  ... VEHICLE TYPE CODE 4  VEHICLE TYPE CODE 5
0       09/26/2018  12:12  ...                 NaN                  NaN
1       09/25/2018  16:30  ...                 NaN                  NaN
2       08/22/2019  19:30  ...                 NaN                  NaN
3       09/23/2018  13:10  ...                 NaN                  NaN
4       08/20/2019  22:40  ...                 NaN                  NaN
...            ...    ...  ...                 ...                  ...
238517  01/20/2018  15:00  ...                 NaN                  NaN
238518  01/04/2018  14:00  ...                 NaN                  NaN
238519  01/20/2018  13:05  ...                 NaN                  NaN
238520  01/29/2018  17:45  ...                 NaN                  NaN
238521  01/23/2018  16:38  ...                 NaN                  NaN

[238522 rows x 24 columns]

df.columns
Index(['DATE', 'TIME', 'BOROUGH', 'ZIP CODE', 'LATITUDE', 'LONGITUDE',
       'ON STREET NAME', 'NUMBER OF PEDESTRIANS INJURED',
       'NUMBER OF PEDESTRIANS KILLED', 'NUMBER OF CYCLIST INJURED',
       'NUMBER OF CYCLIST KILLED', 'NUMBER OF MOTORIST INJURED',
       'NUMBER OF MOTORIST KILLED', 'CONTRIBUTING FACTOR VEHICLE 1',
       'CONTRIBUTING FACTOR VEHICLE 2', 'CONTRIBUTING FACTOR VEHICLE 3',
       'CONTRIBUTING FACTOR VEHICLE 4', 'CONTRIBUTING FACTOR VEHICLE 5',
       'COLLISION_ID', 'VEHICLE TYPE CODE 1', 'VEHICLE TYPE CODE 2',
       'VEHICLE TYPE CODE 3', 'VEHICLE TYPE CODE 4', 'VEHICLE TYPE CODE 5'],
      dtype='object')
      
#Ejercicio 1
Desde 2014, la ciudad de Nueva York ha estado implementando un plan de seguridad vial llamado Vision Zero.
Su objetivo es reducir el número de muertes por accidentes de tránsito a cero para fines de 2024.
El plan está creando nuevas y mejorando las medidas de seguridad actuales, algunas de ellas incluyen:

Auditorías de seguridad vial en lugares de alto riesgo:
El programa de cámaras de velocidad de la ciudad ha reducido la velocidad en más del 60 por ciento en lugares
cerca de las escuelas donde funcionan las cámaras. La policía de tráfico del NYPD enfatiza la aplicación de las
infracciones en movimiento con mayor probabilidad de causar la muerte o lesiones graves. 

Iniciativas específicas de educación y sensibilización:
En 1985, nuestra tasa nacional de uso del cinturón de seguridad rondaba el 20%. Treinta años después,
una combinación de leyes más estrictas, aplicación, educación pública y cambios en el diseño de automóviles
han impulsado el uso del cinturón de seguridad hasta en un 88%.
Los conductores de vehículos de alquiler, autobuses de la MTA
y flotas de la ciudad reciben capacitación y educación de seguridad de vanguardia.

#Ejercicio 2
Agrupe los datos disponibles mensualmente y genere un line plot de accidentes a lo largo del tiempo.

df['DATE']=pd.to_datetime(df['DATE']) #formato datetime python
montly_accidents = df.groupby(df['DATE'].dt.to_period('M')).size()
print(montly_accidents)
montly_accidents.plot.line()
plt.xlabel('Fecha')
plt.ylabel('Frecuencia')
plt.title('Evolución de Accidentes NYC')

DATE
2018-01    11735
2018-02    10395
2018-03    12519
2018-04    11679
2018-05    13438
2018-06    13314
2018-07    12787
2018-08    12644
2018-09    12425
2018-10    13336
2018-11    12447
2018-12    12479
2019-01    11000
2019-02    10310
2019-03    11482
2019-04    10833
2019-05    12642
2019-06    12577
2019-07    12014
2019-08     8466
Freq: M, dtype: int64
Text(0.5, 1.0, 'Evolución de Accidentes NYC')

¿Ha aumentado el número de accidentes durante el último año y medio?
En el 2018 se presentó aumento variable hasta Enero 2019.
Se presentó una reducción en Febrero 2019 y aumentó considerablemente entre Abril y Mayo 2019.
Sin embargo, en 2019 se redujo el número de accidentes en comparación con el año 2018 y sigue descendiendo.
En conclusión, no han aumentado el número de accidentes.

#Ejercicio 3
De la gráfica anterior, ¿qué meses parecen tener el menor número de accidentes?
Febrero de 2018 y 2019, y Abril de 2018 y 2019
¿Cuáles crees que son las razones detrás de esto?
En febrero, porque NYC está en invierno y las nevadas provocan bloqueos en las vías que no permiten que
la ciudadanía use sus vehículos.

#Ejercicio 4
Cree una nueva columna HOUR basada en los datos de la columna TIME,
luego trace un gráfico de barras de la distribución por hora a lo largo del día.

df = pd.DataFrame(montly_accidents,columns=['HOUR'])
df['HOUR'] = pd.to_datetime(df['HOUR']).dt.hour

¿Cómo varía el número de accidentes a lo largo de un solo día?
